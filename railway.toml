[build]
builder = "nixpacks"

[phases.setup]
nixPkgs = ["nodejs_20", "php82", "php82Packages.composer"]

[phases.install]
cmds = [
  "composer install --no-dev --optimize-autoloader",
  "npm ci --production=false"
]

[phases.build]
cmds = [
  "npm run build",
  "php bin/console cache:clear --env=prod --no-debug"
]

[deploy]
startCommand = "sh -c 'php -S 0.0.0.0:${PORT} -t public'"

