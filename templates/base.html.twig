<!DOCTYPE html>
<html lang="hy">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="GsKbQNTzgOBtOY-p6QVbVTu-lDDmH0QCKC1HAkaztJc" />
    <title>{% block title %}AnGo{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}AnGo գեղեցկության սրահ՝ պրոֆեսիոնալ սպասարկում և լավագույն վարպետներ Աբովյանում։{% endblock %}">
    <link rel="canonical" href="{{ absolute_url(app.request.pathinfo) }}">

    {# Favicons (Google Search often ignores SVG-only favicons; include PNG sizes too) #}
    <link rel="icon" type="image/png" sizes="48x48" href="{{ asset('favicon-48x48.png') }}?v={{ asset_version('favicon-48x48.png') }}">
    <link rel="icon" type="image/png" sizes="96x96" href="{{ asset('favicon-96x96.png') }}?v={{ asset_version('favicon-96x96.png') }}">
    <link rel="icon" type="image/png" sizes="144x144" href="{{ asset('favicon-144x144.png') }}?v={{ asset_version('favicon-144x144.png') }}">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ asset('favicon-192x192.png') }}?v={{ asset_version('favicon-192x192.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ asset('apple-touch-icon.png') }}?v={{ asset_version('apple-touch-icon.png') }}">
    <meta name="theme-color" content="#111827">

    {# Open Graph / social previews #}
    {% set __ango_page_title = block('title')|striptags|trim %}
    {% set __ango_page_desc = block('meta_description')|striptags|trim %}
    {% set __ango_page_url = absolute_url(app.request.pathinfo) %}
    {% set __ango_og_image = (__ango_og_image is defined and __ango_og_image) ? __ango_og_image : absolute_url(asset('uploads/photos/ango-logo.png')) %}
    {% set __ango_og_image_alt = (__ango_og_image_alt is defined and __ango_og_image_alt) ? __ango_og_image_alt : 'AnGo' %}
    {% set __ango_og_type = (__ango_og_type is defined and __ango_og_type) ? __ango_og_type : 'website' %}
    <meta property="og:site_name" content="AnGo">
    <meta property="og:title" content="{{ __ango_page_title }}">
    <meta property="og:description" content="{{ __ango_page_desc }}">
    <meta property="og:type" content="{{ __ango_og_type }}">
    <meta property="og:url" content="{{ __ango_page_url }}">
    <meta property="og:image" content="{{ __ango_og_image }}">
    <meta property="og:image:alt" content="{{ __ango_og_image_alt }}">
    <meta property="og:locale" content="hy_AM">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ __ango_page_title }}">
    <meta name="twitter:description" content="{{ __ango_page_desc }}">
    <meta name="twitter:image" content="{{ __ango_og_image }}">
    <meta name="twitter:image:alt" content="{{ __ango_og_image_alt }}">

    {# Tailwind CSS (compiled) #}
    <link rel="stylesheet" href="{{ asset('build/app.css') }}?v={{ asset_version('build/app.css') }}">

    {# Icons #}
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"></noscript>

    {# Fonts #}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+Armenian:wght@300;400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+Armenian:wght@300;400;500;600;700&display=swap" rel="stylesheet"></noscript>
    <style>
        body {
            font-family: 'Inter', 'Noto Sans Armenian', system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
            font-synthesis: none;
            -webkit-font-smoothing: antialiased;
            text-rendering: optimizeLegibility;
        }

        /* Force Armenian content to use Armenian-optimized font */
        :lang(hy) body {
            font-family: 'Noto Sans Armenian', 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
        }

        /* Avoid filter-based drop-shadow (can distort glyph rendering in some browsers) */
        .text-shadow-soft {
            text-shadow: 0 10px 25px rgba(0, 0, 0, 0.55);
        }
    </style>
    {% block structured_data %}
        {% set __ango_json_opts = constant('JSON_UNESCAPED_SLASHES') b-or constant('JSON_UNESCAPED_UNICODE') %}
        {% set __ango_site_url = absolute_url(path('app_home')) %}
        <script type="application/ld+json">
            {{ {
                '@context': 'https://schema.org',
                '@graph': [
                    {
                        '@type': 'WebSite',
                        '@id': __ango_site_url ~ '#website',
                        'url': __ango_site_url,
                        'name': 'AnGo',
                        'inLanguage': 'hy-AM'
                    },
                    {
                        '@type': 'Organization',
                        '@id': __ango_site_url ~ '#organization',
                        'name': 'AnGo',
                        'url': __ango_site_url,
                        'logo': {
                            '@type': 'ImageObject',
                            'url': __ango_og_image
                        },
                        'sameAs': [
                            'https://www.instagram.com/angobeauty__/',
                            'https://www.facebook.com/profile.php?id=61580633960341'
                        ]
                    },
                    {
                        '@type': 'BeautySalon',
                        '@id': __ango_site_url ~ '#localbusiness',
                        'name': 'AnGo',
                        'url': __ango_site_url,
                        'image': __ango_og_image,
                        'telephone': '+37494649924',
                        'address': {
                            '@type': 'PostalAddress',
                            'streetAddress': 'Սարալանջի 22',
                            'addressLocality': 'Աբովյան',
                            'addressCountry': 'AM'
                        },
                        'openingHoursSpecification': [
                            {
                                '@type': 'OpeningHoursSpecification',
                                'dayOfWeek': ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],
                                'opens': '10:00',
                                'closes': '20:00'
                            },
                            {
                                '@type': 'OpeningHoursSpecification',
                                'dayOfWeek': ['Sunday'],
                                'opens': '11:00',
                                'closes': '18:00'
                            }
                        ],
                        'parentOrganization': { '@id': __ango_site_url ~ '#organization' }
                    },
                    {
                        '@type': 'WebPage',
                        '@id': __ango_page_url ~ '#webpage',
                        'url': __ango_page_url,
                        'name': __ango_page_title,
                        'description': __ango_page_desc,
                        'inLanguage': 'hy-AM',
                        'isPartOf': { '@id': __ango_site_url ~ '#website' },
                        'about': { '@id': __ango_site_url ~ '#localbusiness' },
                        'primaryImageOfPage': {
                            '@type': 'ImageObject',
                            'url': __ango_og_image
                        }
                    }
                ]
            }|json_encode(__ango_json_opts)|raw }}
        </script>
    {% endblock %}
    {% block head_extra %}{% endblock %}
    {% block stylesheets %}{% endblock %}
</head>
<body class="bg-gray-50 text-gray-800 flex flex-col min-h-screen">

{# --- HEADER --- #}
<header class="fixed w-full bg-white/95 backdrop-blur shadow-sm z-50 transition-all duration-300 h-16">
    <div class="container mx-auto px-4 h-full flex justify-between items-center">
        <!-- Logo -->
        <a href="{{ path('app_home') }}" class="flex items-center rounded-2xl focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-200">
            <span class="inline-flex items-center rounded-2xl overflow-hidden px-2 py-1 transition duration-200 ease-out transform hover:scale-[1.01]">
                <img
                    src="{{ asset('uploads/photos/ango-logo.png') }}?v={{ asset_version('uploads/photos/ango-logo.png') }}"
                    alt="AnGo"
                    class="w-auto object-contain"
                    style="height: 56px; max-width: 220px;"
                    loading="eager"
                    decoding="async"
                >
            </span>
        </a>

        <!-- Desktop Menu -->
        <nav class="hidden md:flex space-x-6 items-center font-medium text-sm text-gray-600">
            <a href="{{ path('app_home') }}" class="hover:text-pink-600 transition">Գլխավոր</a>

            <!-- Artists Dropdown -->
            <div class="relative group">
                <button class="flex items-center hover:text-pink-600 transition gap-1 h-full">
                    Վարպետներ <i class="fas fa-chevron-down text-xs"></i>
                </button>

                <!-- Fixed Dropdown with Links -->
                <div class="absolute left-0 top-full pt-2 w-48 hidden group-hover:block origin-top-left z-50">
                    <div class="bg-white shadow-xl rounded-lg overflow-hidden border-t-2 border-pink-600">
                        <a href="{{ path('app_artists', {'category': 'hair'}) }}" data-ajax-swap="#artistsContent" class="block px-4 py-2 hover:bg-pink-50 hover:text-pink-600">Վարսահարդարներ</a>
                        <a href="{{ path('app_artists', {'category': 'nails'}) }}" data-ajax-swap="#artistsContent" class="block px-4 py-2 hover:bg-pink-50 hover:text-pink-600">Մատնահարդարներ</a>
                        <a href="{{ path('app_artists', {'category': 'makeup'}) }}" data-ajax-swap="#artistsContent" class="block px-4 py-2 hover:bg-pink-50 hover:text-pink-600">Դիմահարդարներ</a>
                    </div>
                </div>
            </div>

            <a href="{{ path('app_home') }}#our-services" class="hover:text-pink-600 transition">Ծառայություններ</a>
            <a href="{{ path('app_home') }}#about" class="hover:text-pink-600 transition">Մեր մասին</a>
            <a href="{{ path('app_home') }}#contact" class="hover:text-pink-600 transition">Կապ</a>
            <a href="{{ path('app_blog_index') }}" class="hover:text-pink-600 transition">Բլոգ</a>

            {% if app.user %}
                <a href="{{ path('app_profile') }}" class="hover:text-pink-600 transition">
                    <i class="fas fa-user mr-1"></i> Իմ պրոֆիլը
                </a>
                {% if is_granted('ROLE_ADMIN') or is_granted('ROLE_ARTIST') %}
                    <a href="{{ path('admin') }}" class="hover:text-pink-600 transition">
                        <i class="fas fa-cog mr-1"></i> Admin
                    </a>
                {% endif %}
            {% else %}
                <a href="{{ path('app_login') }}" class="hover:text-pink-600 transition">
                    <i class="fas fa-sign-in-alt mr-1"></i> Մուտք
                </a>
                <a href="{{ path('app_signup') }}" class="hover:text-pink-600 transition">
                    <i class="fas fa-user-plus mr-1"></i> Գրանցվել
                </a>
            {% endif %}

            <!-- Booking Button -->
            <a href="#booking" class="bg-gray-900 text-white px-5 py-2.5 rounded-full hover:bg-pink-600 transition shadow-lg transform hover:scale-105 duration-200">
                <i class="far fa-calendar-check mr-2"></i>Ամրագրել
            </a>
        </nav>

        <!-- Mobile Menu Button -->
        <button type="button" aria-label="Բացել/փակել մենյուն" class="md:hidden text-2xl text-gray-700 focus:outline-none" onclick="document.getElementById('mobile-menu').classList.toggle('hidden')">
            <i class="fas fa-bars"></i>
        </button>
    </div>

    <!-- Mobile Menu Dropdown -->
    <div id="mobile-menu" class="hidden md:hidden bg-white border-t absolute w-full shadow-lg">
        <a href="{{ path('app_home') }}" class="block px-6 py-3 border-b hover:bg-gray-50">Գլխավոր</a>
        <div class="block px-6 py-3 border-b bg-gray-50">
            <span class="font-semibold text-pink-600 block mb-2">Վարպետներ</span>
            <div class="pl-4 space-y-2 text-sm text-gray-600 border-l-2 border-pink-200">
                <a href="{{ path('app_artists', {'category': 'hair'}) }}" data-ajax-swap="#artistsContent" class="block py-1">Վարսահարդարներ</a>
                <a href="{{ path('app_artists', {'category': 'nails'}) }}" data-ajax-swap="#artistsContent" class="block py-1">Մատնահարդարներ</a>
                <a href="{{ path('app_artists', {'category': 'makeup'}) }}" data-ajax-swap="#artistsContent" class="block py-1">Դիմահարդարներ</a>
            </div>
        </div>
        <a href="{{ path('app_home') }}#our-services" class="block px-6 py-3 border-b hover:bg-gray-50">Ծառայություններ</a>
        <a href="{{ path('app_home') }}#about" class="block px-6 py-3 border-b hover:bg-gray-50">Մեր մասին</a>
        <a href="{{ path('app_home') }}#contact" class="block px-6 py-3 border-b hover:bg-gray-50">Կապ</a>
        <a href="{{ path('app_blog_index') }}" class="block px-6 py-3 border-b hover:bg-gray-50">Բլոգ</a>

        {% if app.user %}
            <a href="{{ path('app_profile') }}" class="block px-6 py-3 border-b hover:bg-gray-50">Իմ պրոֆիլը</a>
            {% if is_granted('ROLE_ADMIN') or is_granted('ROLE_ARTIST') %}
                <a href="{{ path('admin') }}" class="block px-6 py-3 border-b hover:bg-gray-50">Admin</a>
            {% endif %}
            <a href="{{ path('app_logout') }}" class="block px-6 py-3 border-b hover:bg-gray-50 text-red-600 font-semibold">Ելք</a>
        {% else %}
            <a href="{{ path('app_login') }}" class="block px-6 py-3 border-b hover:bg-gray-50">Մուտք</a>
            <a href="{{ path('app_signup') }}" class="block px-6 py-3 border-b hover:bg-gray-50">Գրանցվել</a>
        {% endif %}

        <a href="#booking" class="block px-6 py-3 border-b hover:bg-gray-50 text-pink-600 font-bold">Ամրագրել հիմա</a>
    </div>
</header>

{# --- MAIN CONTENT --- #}
<main class="flex-grow pt-16">
    {% block body %}{% endblock %}
</main>

{# --- FOOTER --- #}
<footer class="bg-gray-900 text-white py-12">
    <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
            <h3 class="text-xl font-bold mb-4 text-pink-500">AnGo</h3>
            <p class="text-gray-400 text-sm">Ձեր գեղեցկությունը մեր ամենակարևոր հոգսն է։ Լավագույն մասնագետները Աբովյանում։</p>
        </div>
        <div>
            <h4 class="font-bold mb-4">Հասցե</h4>
            <p class="text-gray-400 text-sm"><i class="fas fa-map-marker-alt mr-2"></i> Ք.Աբովյան, Սարալանջի 22</p>
            <p class="text-gray-400 text-sm mt-2"><i class="fas fa-phone mr-2"></i> +374 94 64 99 24</p>
        </div>
        <div>
            <h4 class="font-bold mb-4">Աշխատանքային ժամեր</h4>
            <p class="text-gray-400 text-sm">Երկ - Շաբ: 10:00 - 20:00</p>
            <p class="text-gray-400 text-sm">Կիր: 11:00 - 18:00</p>
        </div>
        <div>
            <h4 class="font-bold mb-4">Սոցիալական</h4>
            <div class="flex space-x-4">
                <a href="https://www.instagram.com/angobeauty__/" target="_blank" rel="noopener noreferrer" aria-label="Instagram" title="Instagram" class="hover:text-pink-500 transition">
                    <i class="fab fa-instagram text-2xl" aria-hidden="true"></i>
                </a>
                <a href="https://www.facebook.com/profile.php?id=61580633960341" target="_blank" rel="noopener noreferrer" aria-label="Facebook" title="Facebook" class="hover:text-pink-500 transition">
                    <i class="fab fa-facebook text-2xl" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
    <div class="text-center mt-12 pt-8 border-t border-gray-800 text-xs text-gray-300">
        &copy; {{ "now"|date("Y") }} AnGo. Բոլոր իրավունքները պաշտպանված են։
    </div>
</footer>

{# --- INCLUDE MODAL --- #}
{% include 'parts/booking_modal.html.twig' %}

{% block javascripts %}{% endblock %}

{# --- AJAX FILTER NAV (no full reload) --- #}
<script>
    (function () {
        let lastSwapId = 0;

        function canHandleClick(e, a) {
            if (e.defaultPrevented) return false;
            if (typeof e.button === 'number' && e.button !== 0) return false;
            if (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey) return false;
            if (a.target && a.target !== '_self') return false;
            if (a.hasAttribute('download')) return false;
            const href = a.getAttribute('href');
            if (!href || href.startsWith('#')) return false;
            return true;
        }

        async function angoSwap(url, selector, push) {
            const swapId = ++lastSwapId;
            const target = document.querySelector(selector);
            if (!target) {
                window.location.href = url;
                return;
            }

            target.setAttribute('aria-busy', 'true');
            target.classList.add('opacity-50', 'pointer-events-none');

            try {
                const resp = await fetch(url, {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'Accept': 'text/html',
                    },
                    credentials: 'same-origin',
                });

                if (!resp.ok) throw new Error('Bad response');
                const html = await resp.text();

                // Ignore out-of-order responses if the user clicked multiple filters quickly
                if (swapId !== lastSwapId) return;

                const doc = new DOMParser().parseFromString(html, 'text/html');
                const next = doc.querySelector(selector);
                if (!next) {
                    window.location.href = url;
                    return;
                }

                target.replaceWith(next);
                if (doc.title) document.title = doc.title;

                if (push) {
                    history.pushState({ __angoAjaxSwap: true, selector }, '', url);
                }
            } catch (err) {
                window.location.href = url;
            } finally {
                const t = document.querySelector(selector);
                if (t) {
                    t.removeAttribute('aria-busy');
                    t.classList.remove('opacity-50', 'pointer-events-none');
                }
            }
        }

        document.addEventListener('click', function (e) {
            const a = e.target.closest('a[data-ajax-swap]');
            if (!a) return;
            if (!canHandleClick(e, a)) return;

            const selector = a.dataset.ajaxSwap;
            const href = a.getAttribute('href');
            if (!selector || !href) return;

            const url = new URL(href, window.location.href);
            if (url.origin !== window.location.origin) return;

            e.preventDefault();

            // Mark current page state so browser Back restores the correct filtered content
            const currentState = history.state || {};
            if (!currentState.__angoAjaxSwap || currentState.selector !== selector) {
                history.replaceState({ ...currentState, __angoAjaxSwap: true, selector }, '', window.location.href);
            }

            angoSwap(url.toString(), selector, true);
        }, true);

        window.addEventListener('popstate', function (e) {
            const state = e.state;
            if (!state || !state.__angoAjaxSwap || !state.selector) return;
            angoSwap(window.location.href, state.selector, false);
        });
    })();
</script>

{# --- SCRIPT FOR BOOKING BUTTON --- #}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const buttons = document.querySelectorAll('a[href="#booking"]');
        buttons.forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                if (typeof openBooking === 'function') {
                    const artistId = btn.dataset.artistId ? String(btn.dataset.artistId) : null;
                    if (artistId) {
                        openBooking({ artistId });
                    } else {
                        openBooking();
                    }
                } else {
                    console.error('Booking modal function not found.');
                }
            });
        });
    });
</script>
</body>
</html>