{% extends 'base.html.twig' %}

{% block title %}
    {% if category %}
        {{ categoryLabel }} Աբովյանում | AnGo
    {% else %}
        Ծառայություններ և գներ Աբովյանում | AnGo
    {% endif %}
{% endblock %}
{% block meta_description %}
    {% if category %}
        AnGo {{ categoryLabel }} ծառայություններ և գներ Աբովյանում։ Տևողություն, գներ և վարպետներ՝ մեկ էջում։
    {% else %}
        AnGo ծառայություններ և գներ Աբովյանում։ Տեսեք բոլոր ծառայությունները՝ կատեգորիաներով, գներով և տևողությամբ։
    {% endif %}
{% endblock %}

{% block structured_data %}
    {{ parent() }}
    {% set __ango_json_opts = constant('JSON_UNESCAPED_SLASHES') b-or constant('JSON_UNESCAPED_UNICODE') %}
    {% set __page_url = absolute_url(app.request.pathinfo) %}
    {% set __seo_keywords = '' %}
    {% if category == 'hair' %}
        {% set __seo_keywords = 'Վարսահարդարում Աբովյանում, վարսավիր, մազերի խնամք, Վարսահարդարման գներ, varsahardarum abovyanum, varsavir abovyan, mazeri xnamq' %}
    {% elseif category == 'nails' %}
        {% set __seo_keywords = 'Մատնահարդարում Աբովյանում, մանիկյուր, պեդիկյուր, շելլակ, գել լաք, маникюр Абовян, шеллак, гель лак, matnahardarum abovyanum, manikyur abovyan, shellac manikyur' %}
    {% elseif category == 'makeup' %}
        {% set __seo_keywords = 'Դիմահարդարում Աբովյանում, հարսանեկան դիմահարդարում, makeup artist, dimahardarum abovyanum, harsanekan dimahardarum, makeup artist abovyan' %}
    {% else %}
        {% set __seo_keywords = 'Գեղեցկության սրահ Աբովյանում, Beauty salon Abovyan, ծառայություններ, գներ, առցանց ամրագրում, վարսահարդարում, մատնահարդարում, դիմահարդարում' %}
    {% endif %}

    {% set __pos = 0 %}
    {% set __items = [] %}
    {% for _cat, cards in groupedServices %}
        {% for card in cards %}
            {% set __pos = __pos + 1 %}
            {% set s = card.service %}
            {% set __items = __items|merge([{
                '@type': 'ListItem',
                'position': __pos,
                'item': {
                    '@type': 'Service',
                    'name': s.name,
                    'url': absolute_url(path('app_service_show', {id: s.id, slug: card.slug}))
                }
            }]) %}
        {% endfor %}
    {% endfor %}

    <script type="application/ld+json">
        {{ {
            '@context': 'https://schema.org',
            '@graph': [
                ({
                    '@type': 'CollectionPage',
                    'name': categoryLabel,
                    'url': __page_url,
                    'inLanguage': 'hy-AM'
                } | merge(__seo_keywords ? {'keywords': __seo_keywords} : {})),
                {
                    '@type': 'ItemList',
                    'name': categoryLabel,
                    'itemListElement': __items
                }
            ]
        }|json_encode(__ango_json_opts)|raw }}
    </script>
{% endblock %}

{% block body %}
    <div class="bg-white">
        <div class="container mx-auto px-4 py-12">
            <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6 mb-10">
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-900">{{ categoryLabel }}</h1>
                    <p class="text-gray-500 mt-2">
                        {% if category %}
                            Տեսեք {{ categoryLabel|lower }} ծառայությունները՝ գներով և տևողությամբ
                        {% else %}
                            Տեսեք բոլոր ծառայությունները՝ կատեգորիաներով, գներով և տևողությամբ
                        {% endif %}
                    </p>
                </div>

                <div class="w-full lg:w-auto">
                    <div class="border-b border-gray-200">
                        <nav class="-mb-px flex items-center space-x-10 overflow-x-auto whitespace-nowrap">
                            {% set tabs = [
                                { key: null, label: 'Բոլորը', href: path('app_service_index') },
                                { key: 'hair', label: 'Վարսահարդարում', href: path('app_service_category', {category: 'hair'}) },
                                { key: 'makeup', label: 'Դիմահարդարում', href: path('app_service_category', {category: 'makeup'}) },
                                { key: 'nails', label: 'Մատնահարդարում', href: path('app_service_category', {category: 'nails'}) }
                            ] %}
                            {% for t in tabs %}
                                {% set isActive = (category is same as(t.key)) %}
                                <a href="{{ t.href }}"
                                   class="px-2 py-2 text-sm font-semibold border-b-2 transition {{ isActive ? 'text-gray-900 border-gray-900' : 'text-gray-500 border-transparent hover:text-gray-900 hover:border-gray-300' }}">
                                    {{ t.label }}
                                </a>
                            {% endfor %}
                        </nav>
                    </div>
                </div>
            </div>

            {% if serviceCards is empty %}
                <div class="text-center py-16 text-gray-500">
                    Այս բաժնում դեռևս ծառայություններ չկան։
                </div>
            {% else %}
                {% for catKey, cards in groupedServices %}
                    {% if cards is not empty %}
                        {% set heading = categoryLabels[catKey]|default(catKey) %}
                        <section class="mb-14">
                            {% if not category %}
                                <div class="flex items-center justify-between mb-6">
                                    <h2 class="text-2xl font-bold text-gray-900">{{ heading }}</h2>
                                    <a href="{{ path('app_service_category', {category: catKey}) }}" class="text-sm font-semibold text-pink-600 hover:underline">
                                        Տեսնել բոլորը →
                                    </a>
                                </div>
                            {% else %}
                                <h2 class="text-2xl font-bold text-gray-900 mb-6">{{ heading }}</h2>
                            {% endif %}

                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {% for card in cards %}
                                    {% set s = card.service %}
                                    <div class="group relative bg-white rounded-2xl border border-gray-100 shadow-sm hover:shadow-xl transition p-6">
                                        <div class="flex items-start justify-between gap-4">
                                            <div class="min-w-0">
                                                <div class="text-lg font-bold text-gray-900 group-hover:text-pink-600 transition truncate">
                                                    {{ s.name }}
                                                </div>
                                                <div class="mt-2 inline-flex items-center gap-2 text-sm text-gray-500">
                                                    <i class="far fa-clock text-gray-400" aria-hidden="true"></i>
                                                    <span>{{ s.durationMinutes }} րոպե</span>
                                                </div>
                                            </div>

                                            <div class="text-right">
                                                <div class="text-xs text-gray-500">Գին</div>
                                                <div class="text-xl font-extrabold text-gray-900 mt-0.5">
                                                    {{ s.price|number_format(0, '.', ' ') }} ֏
                                                </div>
                                            </div>
                                        </div>

                                        <div class="mt-5 flex items-center justify-between">
                                            <div class="text-xs font-semibold bg-pink-50 text-pink-700 px-3 py-1 rounded-full border border-pink-100">
                                                {{ heading }}
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <a href="#booking"
                                                   data-category="{{ s.category }}"
                                                   data-service-id="{{ s.id }}"
                                                   class="relative z-20 inline-flex items-center justify-center rounded-full bg-gray-900 text-white px-4 py-2 text-xs font-bold hover:bg-pink-600 transition focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-200">
                                                    Ամրագրել
                                                </a>
                                                <div class="text-sm font-semibold text-gray-900 group-hover:text-pink-600 transition">
                                                    Տեսնել →
                                                </div>
                                            </div>
                                        </div>

                                        <a href="{{ path('app_service_show', {id: s.id, slug: card.slug}) }}"
                                           class="absolute inset-0 z-10 rounded-2xl focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-200"
                                           aria-label="{{ s.name }} ծառայություն"></a>
                                    </div>
                                {% endfor %}
                            </div>
                        </section>
                    {% endif %}
                {% endfor %}
            {% endif %}

        </div>
    </div>
{% endblock %}


